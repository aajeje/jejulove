<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>M Halftone with Timed Labels</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      overflow: hidden;
    }
    canvas {
      width: 100vw;
      height: 100vh;
      display: block;
      touch-action: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<canvas id="halftoneCanvas"></canvas>
<script>
window.onload = () => {
  const canvas = document.getElementById('halftoneCanvas');
  const ctx = canvas.getContext('2d');

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    initDots();
  }

  window.addEventListener('resize', resizeCanvas);

  let dots = [];
  let backgroundDots = [];
  const SP = 4;
  let W, H, MAX_R;

  let labelTimerStarted = false;
  let labelTimerElapsed = false;

  function initDots() {
    W = canvas.width;
    H = canvas.height;
    MAX_R = (SP / 2) * 1.5;

    dots = [];
    backgroundDots = [];

    const text = 'M';
    let fontSize = Math.min(W, H) * 0.4;

    const off = document.createElement('canvas');
    off.width = W;
    off.height = H;
    const octx = off.getContext('2d');

    let textWidth = Infinity;
    while (textWidth > W - 4 && fontSize > 10) {
      octx.font = `${fontSize}px sans-serif`;
      textWidth = octx.measureText(text).width;
      if (textWidth > W - 4) {
        fontSize -= 10;
      }
    }

    octx.fillStyle = '#fff';
    octx.fillRect(0, 0, W, H);
    octx.fillStyle = '#000';
    octx.font = `${fontSize}px sans-serif`;
    octx.textAlign = 'center';
    octx.textBaseline = 'middle';
    octx.fillText(text, W / 2, H / 2);

    const data = octx.getImageData(0, 0, W, H).data;

    for (let y = 0; y < H; y += SP) {
      const grad = y / H;
      for (let x = 0; x < W; x += SP) {
        const idx = (y * W + x) * 4;
        const brightness = data[idx] / 255;

        let baseR;
        let isText = false;
        if (brightness < 0.9) {
          baseR = MAX_R * (1 - brightness);
          isText = true;
        } else {
          baseR = grad * MAX_R * 0.4;
        }

        if (baseR < 0.3) baseR = 0.3;

        const dot = {
          x,
          y,
          baseR,
          currentR: baseR,
          isText,
          isRed: false,
          label: '',
          phase: Math.random() * Math.PI * 2,
          speed: 0.5 + Math.random() * 1.5,
          labelAlpha: 0,
        };

        dots.push(dot);
        if (!isText) backgroundDots.push(dot);
      }
    }

    if (backgroundDots.length >= 3) {
      const shuffled = backgroundDots.sort(() => 0.5 - Math.random());
      shuffled[0].isRed = true;
      shuffled[0].label = '+821034405337';
      shuffled[0].baseR *= 6;

      shuffled[1].isRed = true;
      shuffled[1].label = 'aajej@hanmail.net';
      shuffled[1].baseR *= 6;

      shuffled[2].isRed = true;
      shuffled[2].label = '카카오톡 오픈 채팅방';
      shuffled[2].baseR *= 6;
    }

    if (!labelTimerStarted) {
      labelTimerStarted = true;
      setTimeout(() => {
        labelTimerElapsed = true;
      }, 3000);
    }
  }

  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const clickY = e.clientY - rect.top;

    for (let dot of dots) {
      if (dot.isRed) {
        const dist = Math.hypot(dot.x - clickX, dot.y - clickY);
        if (dist < SP * 2) {
          if (dot.label === '+821034405337') {
            window.location.href = 'tel:+821034405337';
          } else if (dot.label === 'aajej@hanmail.net') {
            window.location.href =
              'mailto:aajej@hanmail.net?subject=monss%20design&body=monss%20design';
          } else if (dot.label === '카카오톡 오픈 채팅방') {
            window.location.href = 'https://open.kakao.com/o/seDPpmGh';
          }
        }
      }
    }
  });

  function drawFrame(time) {
    ctx.fillStyle = '#fff';
    ctx.fillRect(0, 0, W, H);

    for (let dot of dots) {
      const t = time / 500 * dot.speed + dot.phase;
      const scaleAnim = 0.5 + 0.5 * Math.sin(t);
      let r = dot.baseR * scaleAnim;

      if (dot.isRed) {
        if (labelTimerElapsed) {
          if (dot.labelAlpha < 1.0) {
            dot.labelAlpha += 0.05;
            if (dot.labelAlpha > 1.0) dot.labelAlpha = 1.0;
          }
        }
      }

      if (r < 0.3) continue;

      ctx.beginPath();
      ctx.arc(dot.x, dot.y, r, 0, 2 * Math.PI);
      ctx.fillStyle = dot.isRed ? 'red' : 'black';
      ctx.fill();

      if (dot.isRed && dot.labelAlpha > 0) {
        ctx.globalAlpha = dot.labelAlpha;
        ctx.fillStyle = 'red';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';

        let textWidth = ctx.measureText(dot.label).width;
        let labelX = dot.x;
        let labelY = dot.y - r - 10;

        if (labelX - textWidth / 2 < 0) {
          labelX = textWidth / 2;
        }
        if (labelX + textWidth / 2 > W) {
          labelX = W - textWidth / 2;
        }
        if (labelY - 14 < 0) {
          labelY = dot.y + r + 20;
        }

        ctx.fillText(dot.label, labelX, labelY);
        ctx.globalAlpha = 1.0;
      }
    }

    requestAnimationFrame(drawFrame);
  }

  resizeCanvas();
  requestAnimationFrame(drawFrame);
};
</script>
</body>
</html>
